<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="">
    <title>PolyMixin Docs</title>
    <script type="module" src="ui.js" defer></script>
    <link href="./output.css" rel="stylesheet">
</head>

<body class="bg-slate-800 text-white">
<div id="sidebar-overlay" class="fixed inset-0 bg-black/20 z-40 hidden transition-opacity duration-300"></div>

<div class="lg:flex min-h-screen">
    <aside class="select-none bg-slate-900 flex-col fixed top-0 md:left-0 left-1/2 md:h-full w-1/2 md:w-64 p-4 transform
                    -translate-x-full xl:translate-x-0 xl:flex transition-transform duration-300 z-50 rounded-b-2xl md:rounded-none">
        <div class="px-4 h-16 flex justify-center items-center font-bold bg-slate-900 flex-shrink-0 relative">
            <span class="hidden xl:block">PolyMixin Documentation</span>
            <button id="sidebar-close" class="xl:hidden p-1 text-gray-400 hover:text-white absolute top-2 right-2">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>


        <div class="flex-1 overflow-y-auto mt-2 min-h-0">
            <ul id="sidebar" class="space-y-2 px-2"></ul>
        </div>
    </aside>

    <div class="flex-1 flex flex-col xl:ml-64 min-h-screen">
        <header class="text-white shadow-lg border-b border-b-slate-900/50 h-16 flex items-center justify-between px-6 lg:px-12 flex-shrink-0">
            <h1 class="xl:hidden text-xl font-bold select-none">PolyMixin Docs</h1>
            <div></div>
            <div class="flex items-center relative">
                <a href="https://github.com/Starexify/PolyMixin" target="_blank" class="text-gray-500 hover:text-gray-900 dark:hover:text-white p-2 mr-8">
                    <svg class="size-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor"
                         viewBox="0 0 20 20">
                        <path fill-rule="evenodd"
                              d="M10 .333A9.911 9.911 0 0 0 6.866 19.65c.5.092.678-.215.678-.477 0-.237-.01-1.017-.014-1.845-2.757.6-3.338-1.169-3.338-1.169a2.627 2.627 0 0 0-1.1-1.451c-.9-.615.07-.6.07-.6a2.084 2.084 0 0 1 1.518 1.021 2.11 2.11 0 0 0 2.884.823c.044-.503.268-.973.63-1.325-2.2-.25-4.516-1.1-4.516-4.9A3.832 3.832 0 0 1 4.7 7.068a3.56 3.56 0 0 1 .095-2.623s.832-.266 2.726 1.016a9.409 9.409 0 0 1 4.962 0c1.89-1.282 2.717-1.016 2.717-1.016.366.83.402 1.768.1 2.623a3.827 3.827 0 0 1 1.02 2.659c0 3.807-2.319 4.644-4.525 4.889a2.366 2.366 0 0 1 .673 1.834c0 1.326-.012 2.394-.012 2.72 0 .263.18.572.681.475A9.911 9.911 0 0 0 10 .333Z"
                              clip-rule="evenodd"/>
                    </svg>
                    <span class="sr-only">GitHub account</span>
                </a>
                <div id="sidebar-toggle-wrapper" class="xl:hidden fixed right-4 z-50 transition-transform transition-opacity duration-300 transform opacity-100 scale-100">
                    <button id="sidebar-toggle" class="p-2 text-gray-400 hover:text-white bg-slate-900/50 rounded-lg shadow-md">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>

        <main class="flex-1 py-8 lg:px-16 px-6 lg:pr-24 overflow-y-auto" id="content">
            <h1 class="text-3xl font-bold mb-4">Welcome to PolyMixins Documentation</h1>
            <p>Select a topic from the sidebar to see its content.</p>
        </main>
    </div>
</div>

<script>
    const entries = [
        {
            id: 'getting-started',
            title: 'Getting Started',
            content: `<div class="flex flex-col gap-5">
<p class="text-3xl font-bold mb-2">Understanding PolyMixin</p>

<p class="text-2xl font-bold -ml-2">What is PolyMixin ?</p>
<p class="mb-4"><strong>PolyMixin</strong> is a <strong>framework and API</strong> for V-Slice mods, built on <doc-link href="https://en.wikipedia.org/wiki/Abstract_syntax_tree">AST</doc-link> manipulation.
It is inspired by the mixin pattern used in projects like SpongePowered Mixin (Minecraft), and allows modders to patch or extend scripted classes without modifying their original scripts.</p>

<p class="text-2xl font-bold -ml-2">How does it work ?</p>
<p>PolyMixin hooks into Polymod's scripting system by using the <code-field>PolymodScriptClass</code-field>(<code-field>_abs</code-field>) and modifying the <code-field>_cachedFunctionDecls</code-field> and <code-field>_cachedFieldDecls</code-field>.
It replaces or transforms the function declarations (<code-field>FunctionDecl</code-field>) using the function declaration from another class, which is also a <code-field>PolymodScriptClass</code-field>.</p>
<p class="mb-4">Think of it as "hot-swapping" functions at the AST level.</p>

<p class="text-2xl font-bold -ml-2">Limitations ?</p>
<p>Currently, there are some limitations:</p>
<ul class="list-disc ml-6 mb-4">
  <li>Some transformations are applied later, because mixins may load before or after the base class (always check for PolyMixin and the original module’s availability before using it).</li>
  <li>Lack of testing in actual mods use cases, so behavior may be unpredictable.</li>
</ul>
</div>`,
            subsections: []
        },
        {
            id: 'setup',
            title: 'Setting up PolyMixins',
            content: `<div class="flex flex-col gap-5">
<p class="text-2xl font-bold -ml-2">Preparation</p>
<p>Before you start to use <strong>PolyMixins</strong>, you should have a basic understanding of scripting in V-Slice and how it works.</p>
<div>
  <p>If you are new to V-Slice modding, you may want to check out documentation and tutorials first.</p>
  <p>Here are some resources to get you started:</p>
</div>
<ul class="list-disc ml-6 mb-4 font-bold">
  <li><doc-link href="https://funkincrew.github.io/funkin-modding-docs/">Friday Night Funkin' Modding Documentation</doc-link></li>
  <li><doc-link href="https://thekade.net/funkin-cookbook/">Friday Night Funkin' Cookbook</doc-link></li>
  <li><doc-link href="https://polymod.io/docs/">Polymod Documentation</doc-link></li>
  <li><doc-link href="https://haxe.org/documentation/introduction/">Haxe Documentation</doc-link></li>
</ul>

<p class="text-2xl font-bold -ml-2">Installation</p>
<p>
 To use <strong>PolyMixin</strong> in your project, make sure it is installed as a <strong>mod</strong> inside your Friday Night Funkin' mods folder.
 PolyMixin should be placed alongside your other mods so that it can patch and extend scripts during runtime.
</p>
<p>You can download PolyMixin from:</p>
<ul class="list-disc ml-6 font-bold">
  <li><doc-link href="https://github.com/Starexify/PolyMixin/tree/main">Official GitHub Repo</doc-link></li>
</ul>
<p class="mb-4">After installing, verify that PolyMixin loads correctly before attempting to use any mixin features in your own mods.</p>

<p class="text-2xl font-bold -ml-2">Configuration</p>
<p>Now moving to the juicy stuff, configuration.
PolyMixin gives you the possibility to add your own configuration for mixins to load when the game starts and after hot reloads.
</p>
<div>
  <p>First you need a mixin configuration file. <span class="text-red-700 font-bold">Important!</span> <strong>The file should be placed in <code-field>mods/YourMod/_polymixin_config.json</code-field></strong></p>
  <p>An example of how a configuration file can look like:</p>
</div>
<code-block language="json">
{
  "mixins": [
    { "className": "ExampleSongMixin", "kind": "SongMixin", "params": { "id": "testing", "variation": "default" } },
    { "className": "ExampleModuleMixin", "kind": "Mixin" },
    "BoyfriendMixin"
  ]
}
</code-block>
<p>After adding the configuration file all you need to do for this is add this line in the <code-field>onCreate</code-field> event:</p>
<code-block language="haxe">
override public function onCreate(event:ScriptEvent) {
    Mixins.addConfig("ModID"); // The ModID is the path to your mod's folder, for example "PolyMixin"
}
</code-block>
<p>For more information about configuration, check out the <doc-link href="#classes:mixins" target-off>Mixins</doc-link> class.</p>
</div>`,
            subsections: []
        },
        {
            id: 'annotations',
            title: 'Annotations',
            content: `<note-block>Annotations only work if you use a polymixin config file or handle them yourself using the MixinAnnotationProcessor.</note-block>`,
            subsections: [
                {
                    id: 'overwrite',
                    title: '@:Overwrite',
                    content: `<div class="flex flex-col gap-2">
<p>There are many ways to overwrite functions using mixins, and one of them is by using the <code-field>@:Overwrite</code-field> annotation.</p>
<p>So let's take for example the following snippet of a script:</p>
<code-block language="haxe">
public function test() {
    trace("test() called");
    trace("test() called twice");
}
</code-block>
<p>If you need to overwrite that function here is an example of what you can write in your own <doc-link href="#examples:mixin-class" target-off>Mixin Class</doc-link>:</p>
<code-block language="haxe">
@:Overwrite(method = "test")
function testOverwrite() {
    trace("Overwrote test()");
}
</code-block>
<p>The function would look like this after the overwrite:</p>
<code-block language="haxe">
public function test() {
-    trace("test() called");
-    trace("test() called twice");
+    trace("Overwrote test()");
}
</code-block>
</div>`
                },
                {
                    id: 'inject',
                    title: '@:Inject',
                    content: `<div class="flex flex-col gap-2">
<p>There are many ways to inject into functions using mixins, and one of them is by using the <code-field>@:Inject</code-field> annotation.</p>
<p class="mb-4">But choose carefully because there are many types of injection such as:</p>

<div class="flex flex-col space-y-3">
  <p class="font-bold text-xl">Injecting at the HEAD of a function</p>
  <p>So let's take for example the following snippet of a script:</p>
  <code-block language="haxe">
public function test() {
    trace("test() called");
}
 </code-block>
 <p>If you need to inject code into that function at the beginning here is an example of what you can write in your own <doc-link href="#examples:mixin-class" target-off>Mixin Class</doc-link>:</p>
 <code-block language="haxe">
@:Inject(method = "test", at = "HEAD")
function testInject() {
    trace("Injected into test() at HEAD");
}
 </code-block>
 <p>The function would look like this after the injection:</p>
 <code-block language="haxe">
public function test() {
+    trace("Injected into test() at HEAD");
    trace("test() called");
}
 </code-block>

 <p class="font-bold text-xl mt-4">Injecting at the RETURN of a function</p>
 <p>Now let's take another example:</p>
 <code-block language="haxe">
public function test() {
    doSomething();
    return trace("Test Return");
}
 </code-block>
 <p>If you need to inject code into that function before the return here is an example of what you can write in your own <doc-link href="#examples:mixin-class" target-off>Mixin Class</doc-link>:</p>
 <code-block language="haxe">
@:Inject(method = "test", at = "RETURN")
function testInject() {
    trace("Injected into test() at RETURN");
}
 </code-block>
 <p>The function would look like this after the injection:</p>
 <code-block language="haxe">
public function test() {
    doSomething();
+    trace("Injected into test() at RETURN");
    return trace("Test Return");
}
 </code-block>

 <p class="font-bold text-xl mt-4">Injecting at a target inside the function using INVOKE</p>
 <p>And the last example:</p>
 <code-block language="haxe">
public function test() {
    trace("test() called");
    doSomething();
    doSomething();
    trace("test() called x2");
}
 </code-block>
 <p>If you need to inject code into that function before doSomething() here is an example of what you can write in your own <doc-link href="#examples:mixin-class" target-off>Mixin Class</doc-link>:</p>
 <code-block language="haxe">
@:Inject(method = "test", at = "INVOKE", target = "doSomething")
function testInject() {
    trace("Injected into test() before doSomething()");
}
 </code-block>
 <p>The function would look like this after the injection:</p>
 <code-block language="haxe">
public function test() {
    trace("test() called");
+    trace("Injected into test() before doSomething()");
    doSomething();
    doSomething();
    trace("test() called x2");
}
   </code-block>

   <tip-block>
     Injection behavior depends on the annotation parameters you use.
     <p class="text-gray-400 text-sm">See <doc-link href="#injection-params" target-off>Injection Parameters</doc-link> for more information.</p>
   </tip-block>
 </div>
</div>`
                },
                {
                    id: 'modify-return',
                    title: '@:ModifyReturn',
                    content: `<div class="flex flex-col gap-2">
<p>There are many ways to modify the return call of a function using mixins, and one of them is by using the <code-field>@:ModifyReturn</code-field> annotation.</p>
<p>Let's take for example the following snippet of a script:</p>
<code-block language="haxe">
public function test() {
    return 20;
}
</code-block>
<p>If you need to modify the return call of that function here is an example of what you can write in your own <doc-link href="#examples:mixin-class" target-off>Mixin Class</doc-link>:</p>
<code-block class="mb-2" language="haxe">
@:ModifyReturn(method = "test", call = testReturnCall)
function testReturn(original:Int) {
    return original + 10;
}

function testReturnCall(original:Int) {
    testReturn(original);
}
</code-block>
<note-block class="mb-4">
  The mixin method (<code-field>testReturn</code-field>) must have a <strong>unique name</strong> that does not exist in the target class.
  Otherwise, the injection will not work.
</note-block>
<note-block class="mb-4">
  The call function (<code-field>testReturnCall</code-field>) is required for the modified return to work!
</note-block>
<p class="text-lg font-bold">After mixins applied:</p>
<code-block language="haxe">
public function test() {
-    return original + 10;
+    return testReturnCall(20 + 10);
}
</code-block>
</div>`
                },
                {
                    id: 'modify-receiver',
                    title: '@:ModifyReceiver',
                    content: `<div class="flex flex-col gap-2">
<p>There are many ways to modify the receiver of a method invocation using mixins, and one of them is by using the <code-field>@:ModifyReceiver</code-field> annotation.</p>
<p>Let's take for example the following snippet of a script:</p>
<code-block language="haxe">
public function test() {
    Test.setX(1);
}
</code-block>
<p>If you need to modify the receiver of that invocation here is an example of what you can write in your own <doc-link href="#examples:mixin-class" target-off>Mixin Class</doc-link>:</p>
<code-block class="mb-2" language="haxe">
@:ModifyReceiver(method = "test", call = testRecCall, target = "Test.setX")
function testRec(receiver:Test, newX:Int) {
    if (newX == 1) {
        return TestMixin;
    }
    return receiver;
}

function testRecCall(receiver:Test, newX:Int) {
    testRec(receiver, newX);
}
</code-block>
<note-block class="mb-4">
  The mixin method (<code-field>testRec</code-field>) must have a <strong>unique name</strong> that does not exist in the target class.
  Otherwise, the injection will not work.
</note-block>
<note-block class="mb-4">
  The call function (<code-field>testRecCall</code-field>) is required for the modified return to work!
</note-block>
<p class="text-lg font-bold">After mixins applied:</p>
<code-block language="haxe">
public function test() {
-    Test.setX(1);
+    testRec(Test, 1).setX(1);
}
</code-block>
<tip-block>
  Injection behavior depends on the annotation parameters you use.
  <p class="text-gray-400 text-sm">See <doc-link href="#injection-params" target-off>Injection Parameters</doc-link> for more information.</p>
</tip-block>
</div>`
                },
                {
                    id: 'modify-expression',
                    title: '@:ModifyExpression',
                    content: `<div class="flex flex-col gap-2">
<p>There are many ways to modify the expression call of a function using mixins, and one of them is by using the <code-field>@:ModifyExpression</code-field> annotation.</p>
<p>Let's take for example the following snippet of a script:</p>
<code-block language="haxe">
public function test() {
    if (true) trace(true);
    if (false) trace(false);
    if (true) trace("true x2");
    if (true) trace("true x3");
}
</code-block>
<p>If you need to modify the return call of that function here is an example of what you can write in your own <doc-link href="#examples:mixin-class" target-off>Mixin Class</doc-link>:</p>
<code-block class="mb-2" language="haxe">
@:ModifyExpression(method = "test", call = testExprCall, target = true, ordinal = 0)
function testExpr(original:Bool) {
    return false;
}

function testExprCall(original:Bool) {
    testExpr(original);
}
</code-block>
<note-block class="mb-4">
  The mixin method (<code-field>testExpr</code-field>) must have a <strong>unique name</strong> that does not exist in the target class.
  Otherwise, the injection will not work.
</note-block>
<note-block class="mb-4">
  The call function (<code-field>testExprCall</code-field>) is required for the modified return to work!
</note-block>
<p class="text-lg font-bold">After mixins applied:</p>
<code-block language="haxe">
public function test() {
-    if (true) trace(true);
+    if (testExprCall(testExpr(true))) trace(true);
    if (false) trace(false);
    if (true) trace("true x2");
    if (true) trace("true x3");
}
</code-block>
<tip-block>
  Injection behavior depends on the annotation parameters you use.
  <p class="text-gray-400 text-sm">See <doc-link href="#injection-params" target-off>Injection Parameters</doc-link> for more information.</p>
</tip-block>
</div>`
                },
                {
                    id: 'inject-function',
                    title: '@:InjectFunction',
                    content: `<div class="flex flex-col gap-2">
<p>There are many ways to inject a function using mixins, and one of them is by using the <code-field>@:InjectFunction</code-field> annotation.</p>
<p>So let's take for example you need a function inside a class, here is an example of what you can write in your own <doc-link href="#examples:mixin-class" target-off>Mixin Class</doc-link> for that:</p>
<code-block language="haxe">
@:InjectFunction
function newTest() {
    trace("newTest() function injected");
}
</code-block>
<p>The class would now have this function and can be used:</p>
<code-block language="haxe">
function newTest() {
    trace("newTest() function injected");
}
</code-block>
</div>`
                }
            ]
        },
        {
            id: 'injection-params',
            title: 'Injection Parameters',
            content: `<div class="flex flex-col gap-3">
<p class="mb-4">Injection Parameters define where and when mixins annotations or functions apply their injection.</p>

<p class="text-2xl font-bold -ml-2">Method (Target Method)</p>
<p class="mb-6">The <code-field>method</code-field> parameter specifies which method/function the mixin function will inject into.</p>

<p class="text-2xl font-bold -ml-2">At (Injection Point)</p>
<p>The <code-field>at</code-field> parameter specifies the point where the mixin function is injected.</p>
<p>Supported values:</p>
<data-table class="mb-4"
    data-headers="Enum,String,Description"
    data-json='[
        ["At.HEAD", "\\"HEAD\\"", "Injects at the beginning"],
        ["At.TAIL", "\\"TAIL\\"", "Injects at the bottom"],
        ["At.INVOKE", "\\"INVOKE\\"", "Injects at a specific method call {small}(can be used with \`Shift\`){/small}"],
        ["At.RETURN", "\\"RETURN\\"", "Injects before \`return\`"]
    ]'>
</data-table>

<p class="text-2xl font-bold -ml-2">Shift (Injection Positioning)</p>
<p>The <code-field>shift</code-field> parameter adjusts the position of an injection, most often with <code-field>At.INVOKE</code-field></p>
<p>Options:</p>
<data-table class="mb-4"
    data-headers="Enum,String,Description"
    data-json='[
        ["Shift.BEFORE", "\\"BEFORE\\"", "before the injection point"],
        ["Shift.AFTER", "\\"AFTER\\"", "after the injection point"]
    ]'>
</data-table>

<p class="text-2xl font-bold -ml-2">Target (Injection Target)</p>
<p class="mb-6">The <code-field>target</code-field> parameter defines the specific method or instruction the mixin should inject into. Mainly used alongside <code-field>At.INVOKE</code-field>.</p>

<p class="text-2xl font-bold -ml-2">Ordinal</p>
<p>The <code-field>ordinal</code-field> parameter selects which occurrence of a target to inject into. Usually used with a <code-field>Target</code-field> but can sometimes be used with <code-field>At.RETURN</code-field>.</p>
<data-table class="mb-4"
    data-headers="Integer,Description">
    <code-field>-1</code-field> | inject at every matching target
    <code-field>0</code-field> or higher | inject at that specific index
</data-table>

<p class="text-2xl font-bold -ml-2">Call</p>
<p class="mb-6">The <code-field>call</code-field> parameter specifies the function call where the mixin function will be applied. Mainly used alongside <doc-link href="#annotations:modify-return" target-off>@:ModifyReturn</doc-link> & <doc-link href="#annotations:modify-expression" target-off>@:ModifyExpression</doc-link>.</p>
</div>`,
            subsections: []
        },
        {
            id: 'classes',
            title: 'Classes',
            content: `<note-block text="Info">For more information about the classes check the source code from the <doc-link href="https://github.com/Starexify/PolyMixin">GitHub Repo</doc-link></note-block>`,
            subsections: [
                {
                    id: 'polymixin',
                    title: 'PolyMixin',
                    content: `<div class="flex flex-col gap-3">
<p>PolyMixin is the main class which handles all the transformation related logic, providing helper functions for AST injection which can be used by mods aswell.</p>
<p>It contains the following API methods:</p>
<data-table class="mb-4"
    data-headers="Method,Parameters,Description"
    data-json='[
        ["modifyByRecName()", "targetInstance, targetFuncName, sourceInstance, sourceFuncName, callFuncName, at, ?target, ?ordinal", "Wraps the receiver of method calls with a mixin function call. Only supports injection at method invocations (At.INVOKE)."],
        ["modifyByName()", "targetInstance, targetFuncName, sourceInstance, sourceFuncName, callFuncName, at, ?target, ?ordinal", "Wraps return values or expressions with a mixin function call. Uses empty recall template to modify specific parts like return statements (At.RETURN) or expressions (At.INVOKE)."],
        ["injectByName()", "targetInstance, targetFuncName, sourceInstance, sourceFuncName, at, ?target, ?ordinal, ?shift", "Injects source function contents into target function at specified locations: HEAD (start), TAIL (end), RETURN (before returns), or INVOKE (around method calls)."],
        ["injectFunction()", "targetInstance, sourceInstance, sourceFuncName", "Copies a complete function from source to target instance, adding it to both function cache and AST as if originally declared there."],
        ["overwrite()", "targetInstance, targetFuncName, sourceInstance, sourceFuncName", "Completely replaces target function body with source function, making them identical in functionality."]
    ]'>
</data-table>
</div>`
                },
                {
                    id: 'mixin-annotation-proc',
                    title: 'MixinAnnotationProcessor',
                    content: `<div class="flex flex-col gap-3">
<p>The MixinAnnotationProcessor is an API class which can apply all the mixins from a <doc-link href="#examples:mixin-class" target-off>Mixin Class</doc-link> which contains mixin annotations.</p>
<p>It contains the following API methods:</p>
<data-table class="mb-4"
    data-headers="Method,Parameters,Description"
    data-json='[
        ["applyMixins()", "source, target", "Applies all mixins from source class to target instance. Processes both instance and static fields from the class definition."],
        ["applyModuleMixins()", "source, className", "Applies mixins to a \`ScriptedModule\` by class name using \`ASTUtil.getScriptedModule()\`."],
        ["applySongMixins()", "source, id, ?params", "Applies mixins to a \`ScriptedSong\` by ID with optional song parameters."],
        ["applyLevelMixins()", "source, id", "Applies mixins to a \`ScriptedLevel\` by ID."],
        ["applyNoteStyleMixins()", "source, id", "Applies mixins to a \`ScriptedNoteStyle\` by ID."],
        ["applyPlayerMixins()", "source, id", "Applies mixins to a \`ScriptedPlayer\` by ID."],
        ["applyConversationMixins()", "source, id", "Applies mixins to a \`ScriptedConversation\` by ID."],
        ["applyDialogueMixins()", "source, id", "Applies mixins to a \`ScriptedDialogue\` by ID."],
        ["applySpeakerMixins()", "source, id", "Applies mixins to a \`ScriptedSpeaker\` by ID."],
        ["applyAlbumMixins()", "source, id", "Applies mixins to a \`ScriptedAlbum\` by ID."],
        ["applyStageMixins()", "source, id", "Applies mixins to a \`ScriptedStage\` by ID."],
        ["applyStickerMixins()", "source, id", "Applies mixins to a \`ScriptedSticker\` by ID."],
        ["applyFreeplayStyleMixins()", "source, id", "Applies mixins to a \`ScriptedFreeplayStyle\` by ID."],
        ["applySongEventMixins()", "source, id", "Applies mixins to a \`ScriptedSongEvent\` by ID."],
        ["applyNoteKindMixins()", "source, id", "Applies mixins to a \`ScriptedNoteKind\` by ID."]
    ]'>
</data-table>
</div>`
                },
                {
                    id: 'mixins',
                    title: 'Mixins',
                    content: `<div class="flex flex-col gap-3">
<p>Mixins provides helper functions for adding your own config into PolyMixin so it can be automatically loaded when the game just started or hot reloaded.</p>
<p>A configuration file can look like:</p>
<code-block language="json">
{
  "mixins": [
    { "className": "ExampleSongMixin", "kind": "SongMixin", "params": { "id": "testing", "variation": "default" } },
    { "className": "ExampleModuleMixin", "kind": "Mixin" },
    "BoyfriendMixin"
  ]
}
</code-block>
<p class="mb-4"><span class="text-red-800 font-bold text-lg">! IMPORTANT</span> The json file should always be named <code-field>_polymixin_config.json</code-field> or the Mixins class will never recognize it.</p>
<p>Now let's talk about the fields of the config</p>
<div class="space-y-3">
  <p>First, the <code-field>"className"</code-field> is the name of the <doc-link href="#examples:mixin-class" target-off>Mixin Class</doc-link>, in this case "ExampleSongMixin" or "BoyfriendMixin".
  Also, note that the map <code-field>{ "className": ... }</code-field> is not required if there are no other fields given such as "kind".</p>
  <p>Next field is <code-field>"kind"</code-field>, this decides what kind of scripted class the mixin will be applied to, for example "SongMixin" will be applied to a <code-field>ScriptedSong</code-field> or "Mixin" to a <code-field>ScriptedModule</code-field></p>
  <p>The currently supported scripted classes for mixins using configs or Mixin Class annotations (<code-field>@:MixinKind</code-field>) are:</p>
  <data-table
    data-headers="Script,Kind,String"
    data-json='[
      ["ScriptedModule", "MixinKind.Mixin", "Mixin/ModuleMixin"],
      ["ScriptedSong", "MixinKind.SongMixin", "SongMixin"],
      ["ScriptedLevel", "MixinKind.LevelMixin", "LevelMixin"],
      ["ScriptedNoteStyle", "MixinKind.NoteStyleMixin", "NoteStyleMixin"],
      ["ScriptedPlayer", "MixinKind.PlayerMixin", "PlayerMixin"],
      ["ScriptedConversation", "MixinKind.DialogueBoxMixin", "DialogueMixin"],
      ["ScriptedDialogueBox", "MixinKind.DialogueBoxMixin", "DialogueBoxMixin"],
      ["ScriptedSpeaker", "MixinKind.SpeakerMixin", "SpeakerMixin"],
      ["ScriptedAlbum", "MixinKind.AlbumMixin", "AlbumMixin"],
      ["ScriptedStage", "MixinKind.StageMixin", "StageMixin"],
      ["ScriptedSticker", "MixinKind.StickerMixin", "StickerMixin"],
      ["ScriptedFreeplayStyle", "MixinKind.FreeplayStyleMixin", "FreeplayStyleMixin"],
      ["ScriptedSongEvent", "MixinKind.SongEventMixin", "SongEventMixin"],
      ["ScriptedNoteKind", "MixinKind.NoteKindMixin", "NoteKindMixin"]
    ]'>
  </data-table>
  <note-block class="block mt-2 mb-5">As long as you have an instance of the scripted class, you can modify it at any time using either the <doc-link href="#classes:polymixin" target-off>PolyMixins</doc-link> or <doc-link href="#classes:mixin-annotation-proc" target-off>MixinAnnotationProcessor</doc-link>.</note-block>
  <p>Next field is <code-field>"params"</code-field>, at the moment this field is only used by <code-field>ScriptedSongs</code-field> and contains a "variation", since they use a parameter for variation-specific song scripts.</p>
</div>

<p>To register your configuration file for PolyMixin to be able to use it you have to add this line in the <code-field>onCreate</code-field> event:</p>
<code-block language="haxe">
override public function onCreate(event:ScriptEvent) {
    Mixins.addConfig("ModID"); // The ModID is the path to your mod's folder, for example "PolyMixin"
}
</code-block>
</div>`
                }
            ]
        },
        {
            id: 'examples',
            title: 'Examples',
            content: ``,
            subsections: [
                {
                    id: 'mixin-class',
                    title: 'Mixin Classes',
                    content: `<div class="flex flex-col gap-3">
<p>Mixin Classes are simply classes that can be used to apply transformations into scripted classes via many different methods.</p>
<p class="text-2xl font-bold -ml-2">Mixin Class Annotations + Configuration</p>
<p>A class using Mixin Class Annotations looks like:</p>
<code-block>
@:Mixin(TargetClass)
class TargetClassMixin extends ScriptedModule {

    @:Overwrite(method = "test")
    function testOverwrite() {
        trace("Overwrote test()");
    }

    // Other injections or functions...
}
</code-block>
<p>The <code-field>@:Mixin</code-field> field determines the MixinKind (Check <doc-link href="#classes:mixins" target-off>Mixins</doc-link> for more information)</p>
<p class="mb-4">Then inside the annotation we can have different parameters, first being the target script (<code-field>TargetClass</code-field> in this example), or for <code-field>SongMixin</code-field> we can also have <code-field>variation = "pico"</code-field></p>

<p class="text-2xl font-bold -ml-2">MixinAnnotationProcessor + Annotations</p>
<p>A class using the <doc-link href="#classes:mixin-annotation-proc" target-off>MixinAnnotationProcessor</doc-link> and <doc-link href="#annotations:overwrite" target-off>Annotations</doc-link> looks like:</p>
<code-block>
class TargetClassMixin extends ScriptedModule {
    var injected:Bool = false;

    override public function onUpdate(event:UpdateScriptEvent) {
        if (injected) return;
        if (injected) trace("Injection succeeded!");
        injected = MixinAnnotationProcessor.applyMixins(this, TargetClass.instance);
    }

    @:Overwrite(method = "test")
    function testOverwrite() {
        trace("Overwrote test()");
    }

    // Other injections or functions...
}
</code-block>
<p class="mb-4">As you notice, in this example it checks for the injection using a boolean <code-field>onUpdate</code-field> because the classes might not exist which is a bit more tricky than the configuration method.</p>

<p class="text-2xl font-bold -ml-2">PolyMixins</p>
<p>A class using the <doc-link href="#classes:polymixin" target-off>PolyMixin</doc-link> looks like:</p>
<code-block>
class TargetClassMixin extends ScriptedModule {
    var injected:Bool = false;

    override public function onUpdate(event:UpdateScriptEvent) {
        if (injected) return;
        if (injected) trace("Injection succeeded!");
        injected = PolyMixin.injectFunction(TargetClass.instance, this, "newFunc");
    }

    function newFunc() {
        trace("New func called from TargetClass!");
    }

    // Other injections or functions...
}
</code-block>
<p class="mb-4">As you notice, in this example we go at the lowest level, having to manage mixins ourselves for each case, no automatic annotation checks from MixinAnnotationProcessor, no Configuration, just plain transformation via helper functions.</p>
</div>`
                }
            ]
        }
    ];

    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const sidebarClose = document.getElementById('sidebar-close');
    const sidebarEl = document.querySelector('aside');
    const content = document.getElementById('content');
    const overlay = document.getElementById('sidebar-overlay');
    const sidebarToggleWrapper = document.getElementById('sidebar-toggle-wrapper');

    function openSidebar() {
        if (window.innerWidth < 768) sidebarEl.classList.remove('-translate-y-full');
        else sidebarEl.classList.remove('-translate-x-full');

        if (window.innerWidth < 1280) overlay.classList.remove('hidden');
        sidebarToggleWrapper.classList.remove('opacity-100', 'scale-100');
        sidebarToggleWrapper.classList.add('opacity-0', 'scale-75');
    }

    function closeSidebar() {
        if (window.innerWidth < 768) sidebarEl.classList.add('-translate-y-full');
        else sidebarEl.classList.add('-translate-x-full');

        overlay.classList.add('hidden');
        sidebarToggleWrapper.classList.remove('opacity-0', 'scale-75');
        sidebarToggleWrapper.classList.add('opacity-100', 'scale-100');
    }

    sidebarToggle.addEventListener('click', openSidebar);
    sidebarClose.addEventListener('click', closeSidebar);

    function initializeSidebar() {
        if (window.innerWidth >= 1280) { // xl breakpoint - desktop
            sidebarEl.classList.remove('-translate-x-full', '-translate-y-full');
            sidebarEl.classList.add('flex'); // ensure it's visible
        } else if (window.innerWidth >= 768) { // md to xl - tablet
            sidebarEl.classList.remove('-translate-y-full');
            sidebarEl.classList.add('-translate-x-full'); // start closed
        } else { // mobile - smaller than md
            sidebarEl.classList.remove('-translate-x-full');
            sidebarEl.classList.add('-translate-y-full'); // start closed
        }

        // Ensure overlay hidden if not mobile
        overlay.classList.add('hidden');
    }

    document.addEventListener('DOMContentLoaded', initializeSidebar);
    window.addEventListener('load', initializeSidebar);
    window.addEventListener('resize', initializeSidebar);

    // Populate sidebar with entries
    const links = {};
    const flatEntries = [];
    entries.forEach(entry => {
        const li = document.createElement('li');

        const button = document.createElement('button');
        button.className = "flex items-center justify-between w-full text-left text-gray-400 hover:text-blue-500 py-2 transition-colors font-medium hover:cursor-pointer";
        button.textContent = entry.title;

        li.appendChild(button);

        if (entry.subsections.length) {
            // Create transitionable arrow
            const arrow = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            arrow.setAttribute("class", "w-3 h-3 transition-transform duration-200 -rotate-90");
            arrow.setAttribute("viewBox", "0 0 10 6");
            arrow.setAttribute("fill", "none");
            arrow.innerHTML = `<path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1l4 4 4-4"/>`;
            button.appendChild(arrow);

            const subUl = document.createElement('ul');
            subUl.className = "ml-4 space-y-2 hidden";

            entry.subsections.forEach(sub => {
                const subLi = document.createElement('li');
                const subLink = document.createElement('a');
                subLink.href = `#${entry.id}:${sub.id}`;
                subLink.textContent = sub.title;
                subLink.className = "block text-gray-400 hover:text-blue-500 text-sm";
                subLi.appendChild(subLink);
                subUl.appendChild(subLi);
                links[`${entry.id}:${sub.id}`] = subLink;
            });

            li.appendChild(subUl);

            button.addEventListener('click', () => {
                const isHidden = subUl.classList.contains('hidden');
                subUl.classList.toggle('hidden');

                // Toggle arrow rotation: closed (-rotate-90) <-> open (rotate-0)
                if (isHidden) {
                    arrow.classList.remove('-rotate-90');
                    arrow.classList.add('rotate-0');
                } else {
                    arrow.classList.remove('rotate-0');
                    arrow.classList.add('-rotate-90');
                }
            });
        } else {
            button.addEventListener('click', () => {
                window.location.hash = entry.id;
            });
        }

        sidebar.appendChild(li);
        links[entry.id] = button;
        if (entry.subsections.length > 0) entry.subsections.forEach(sub => {
            flatEntries.push({id: `${entry.id}:${sub.id}`, title: sub.title});
        });
        else flatEntries.push({id: entry.id, title: entry.title});
    });

    // Load an entry by ID
    function loadEntry(hash) {
        if (!hash) return;

        const [sectionId, subsectionId] = hash.split(':');
        const section = entries.find(e => e.id === sectionId);
        if (!section) return;

        let html = `<h1 class="text-4xl font-bold pb-8">${section.title}</h1>
                <hr class="border-slate-600 mb-6">
                ${section.content}`;

        if (subsectionId) {
            const sub = section.subsections.find(s => s.id === subsectionId);
            if (sub) html += `<h2 class="text-2xl font-bold mt-10 mb-3">${sub.title}</h2>${sub.content}`;
        }

        html += `<div id="bottom-nav" class="flex justify-center md:gap-4 fixed bottom-0 left-0 right-0 md:border-0 border-t md:bg-transparent border-slate-600 bg-slate-800/50 backdrop-blur-md p-1 rounded-lg md:p-3 md:static md:bg-transparent md:mt-8 md:mx-10 md:mb-0 pb-safe transition-opacity duration-500 ease-in-out">
    <button id="prevSection" class="flex-1 flex flex-col items-start min-w-0 md:border border-r border-slate-600 hover:border-blue-500 py-2 px-4 md:rounded-xl hover:cursor-pointer disabled:opacity-0">
        <span class="text-sm font-semibold">← Previous</span>
        <span id="prevId" class="text-blue-500 mt-1 truncate block max-w-full"></span>
    </button>
    <button id="nextSection" class="flex-1 flex flex-col items-end min-w-0 md:border border-l border-slate-600 hover:border-blue-500 py-2 px-4 md:rounded-xl hover:cursor-pointer disabled:opacity-0">
        <span class="text-sm font-semibold">Next →</span>
        <span id="nextId" class="text-blue-500 mt-1 truncate block max-w-full"></span>
    </button>
</div>`;

        content.innerHTML = html;

        // Highlight section
        Object.values(links).forEach(link => {
            link.classList.remove('text-blue-600', 'font-bold');
            link.classList.add('text-gray-400');
        });

        const activeLink = links[hash] || links[sectionId];
        if (activeLink) {
            activeLink.classList.add('text-blue-600', 'font-bold');
            activeLink.classList.remove('text-gray-400');
        }

        // Open parent section if subsection is active
        if (subsectionId) {
            const parentUl = activeLink.closest('ul');
            if (parentUl) {
                parentUl.classList.remove('hidden');

                // Make sure arrow points down when opened
                const parentButton = parentUl.previousElementSibling;
                const arrowSvg = parentButton.querySelector('svg');
                if (arrowSvg) {
                    arrowSvg.classList.remove('-rotate-90');
                    arrowSvg.classList.add('rotate-0');
                }
            }
        }

        const index = flatEntries.findIndex(e => e.id === hash);
        const prevBtn = document.getElementById('prevSection');
        const nextBtn = document.getElementById('nextSection');
        const prevIdSpan = document.getElementById('prevId');
        const nextIdSpan = document.getElementById('nextId');

        if (index > 0) {
            prevBtn.disabled = false;
            prevIdSpan.textContent = flatEntries[index - 1].title;
            prevBtn.onclick = () => window.location.hash = flatEntries[index - 1].id;
        } else {
            prevBtn.disabled = true;
            prevIdSpan.textContent = '';
        }

        if (index < flatEntries.length - 1) {
            nextBtn.disabled = false;
            nextIdSpan.textContent = flatEntries[index + 1].title;
            nextBtn.onclick = () => window.location.hash = flatEntries[index + 1].id;
        } else {
            nextBtn.disabled = true;
            nextIdSpan.textContent = '';
        }
    }

    // Handle Keybinds for switching pages
    document.addEventListener('keydown', (e) => {
        const hash = window.location.hash.substring(1);
        const index = flatEntries.findIndex(entry => entry.id === hash);
        if (index === -1) return;

        switch (e.key) {
            case "Enter":
            case "ArrowRight":
                if (index < flatEntries.length - 1) window.location.hash = flatEntries[index + 1].id;
                break;
            case "ArrowLeft":
            case "Backspace":
                if (index > 0) window.location.hash = flatEntries[index - 1].id;
                break;
        }
    });

    // Load entry when hash changes
    window.addEventListener('hashchange', () => loadEntry(window.location.hash.substring(1)));
    if (window.location.hash) loadEntry(window.location.hash.substring(1));
    if (overlay) overlay.addEventListener('click', closeSidebar);

    // Hide UI for readability
    const uiElements = [sidebarToggleWrapper, document.getElementById('bottom-nav')];
    let hideTimeout;

    function showUI() {
        uiElements.forEach(el => {
            if (!el) return;
            if (el.id === 'bottom-nav' && window.innerWidth >= 768) return;
            if (el) el.classList.remove('opacity-0', 'pointer-events-none', 'scale-75');
            if (el) el.classList.add('opacity-100', 'scale-100');
        });
    }

    function hideUI() {
        uiElements.forEach(el => {
            if (!el) return;
            if (el.id === 'bottom-nav' && window.innerWidth >= 768) return;
            if (el) el.classList.remove('opacity-100', 'scale-100');
            if (el) el.classList.add('opacity-0', 'pointer-events-none', 'scale-75');
        });
    }

    function resetHideTimer() {
        const sidebarClosed = (window.innerWidth < 768)
            ? sidebarEl.classList.contains('-translate-y-full')
            : sidebarEl.classList.contains('-translate-x-full');
        if (!sidebarClosed) return;

        showUI();
        clearTimeout(hideTimeout);
        hideTimeout = setTimeout(() => {
            hideUI();
        }, 3000); // 3 seconds of inactivity
    }

    window.addEventListener('mousemove', resetHideTimer);
    window.addEventListener('touchstart', resetHideTimer);
    window.addEventListener('scroll', resetHideTimer);

    resetHideTimer();
</script>

</body>
</html>